# Copyright (c) Mondoo, Inc.
# SPDX-License-Identifier: BUSL-1.1

# Full example with all available options
apiVersion: k8s.mondoo.com/v1alpha2
kind: MondooAuditConfig
metadata:
  name: mondoo-client
  namespace: mondoo-operator
spec:
  # Required: Reference to secret containing Mondoo service account credentials
  mondooCredsSecretRef:
    name: mondoo-client

  # Optional: Reference to secret containing a Mondoo registration token
  # If provided and mondooCredsSecretRef secret doesn't exist, the operator
  # will exchange this token for a service account
  # mondooTokenSecretRef:
  #   name: mondoo-token

  # Scanner settings (applies to K8s resources and container scanning)
  scanner:
    serviceAccountName: mondoo-operator-k8s-resources-scanning
    image:
      name: ghcr.io/mondoohq/mondoo-operator
      tag: latest
    resources:
      requests:
        cpu: 100m
        memory: 100Mi
      limits:
        cpu: 500m
        memory: 500Mi
    # For private registries
    # privateRegistriesPullSecretRef:
    #   name: mondoo-private-registries-secrets

  # Kubernetes resources scanning (RBAC, workloads, etc.)
  kubernetesResources:
    enable: true
    # Cron schedule (default: random minute each hour)
    # schedule: "0 * * * *"

    # External clusters to scan from this operator instance
    # externalClusters:
    #   - name: production
    #     kubeconfigSecretRef:
    #       name: prod-kubeconfig
    #     # Optional: override schedule for this cluster
    #     # schedule: "0 */2 * * *"
    #     # Optional: cluster-specific filtering
    #     # filtering:
    #     #   namespaces:
    #     #     exclude:
    #     #       - kube-system

  # Container image scanning
  containers:
    enable: true
    # Cron schedule (default: daily)
    # schedule: "0 0 * * *"
    resources:
      requests:
        cpu: 100m
        memory: 100Mi
      limits:
        cpu: 500m
        memory: 500Mi

  # Node scanning
  nodes:
    enable: true
    # Style: cronjob (default), deployment, or daemonset
    style: cronjob
    # Cron schedule (only for cronjob style)
    # schedule: "0 * * * *"
    # Interval in minutes (only for deployment style)
    # intervalTimer: 60
    resources:
      requests:
        cpu: 100m
        memory: 100Mi
      limits:
        cpu: 500m
        memory: 500Mi

  # Namespace filtering (applies to K8s resources and container scanning)
  filtering:
    namespaces:
      # Exclude specific namespaces
      exclude:
        - kube-system
      # Or include only specific namespaces (overrides exclude)
      # include:
      #   - default
      #   - production
